<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>PickMyBinge | Find Binge-Worthy Movies & TV Shows Instantly</title>
    
    <meta name="description" content="Tired of endless scrolling? PickMyBinge helps you discover your next favorite movie or TV show. Get personalized recommendations for Action, Comedy, Korean dramas, and more.">
    
    <link rel="canonical" href="https://www.pickmybinge.com/" />
    <meta name="robots" content="index, follow">
    
    <!-- Google AdSense Script -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7381421031784616"
     crossorigin="anonymous"></script>

    <meta property="og:title" content="PickMyBinge | Find Your Next Binge-Worthy Show">
    <meta property="og:description" content="Instantly discover movies and TV shows you'll love with our smart recommendation engine.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.pickmybinge.com/">
    <meta property="og:image" content="https://www.pickmybinge.com/social-preview.png">
    <meta name="twitter:card" content="summary_large_image">

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "PickMyBinge",
        "url": "https://www.pickmybinge.com/",
        "potentialAction": {
            "@type": "SearchAction",
            "target": {
              "@type": "EntryPoint",
              "urlTemplate": "https://www.pickmybinge.com/?q={search_term_string}"
            },
            "query-input": "required name=search_term_string"
        },
        "description": "A movie and TV show recommendation engine that helps users discover what to watch next based on genres and keywords."
    }
    </script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://www.pickmybinge.com/",
      "logo": "https://www.pickmybinge.com/logo.png"
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "What is PickMyBinge?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "PickMyBinge is a smart recommendation tool designed to help you quickly discover binge-worthy movies and TV shows. We use filters for genre, popularity, and ratings to help you stop scrolling and start watching."
        }
      },{
        "@type": "Question",
        "name": "Is this website free to use?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, PickMyBinge is 100% free for everyone. The site is supported by on-page advertisements and affiliate links, which means we may earn a small commission if you sign up for a service we recommend, at no extra cost to you."
        }
      },{
        "@type": "Question",
        "name": "How do you get your movie and TV show data?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Our data, including titles, posters, ratings, and release dates, is generously provided by The Movie Database (TMDB). It is a massive, community-built database that ensures our recommendations are always up-to-date."
        }
      },{
        "@type": "Question",
        "name": "How do the recommendations work?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Our recommendation engine sorts content by popularity and high user ratings from millions of viewers. When you select a genre, it finds the most-loved titles in that category, helping you discover proven hits you're likely to enjoy."
        }
      },{
        "@type": "Question",
        "name": "How often is the content updated?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Our movie and TV show library is updated daily through a direct connection with The Movie Database (TMDB), a live, community-driven database. This ensures you always have access to the latest and most popular titles."
        }
      }]
    }
    </script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root { --primary: #FF5E5B; --secondary: #00CECB; --dark: #1E1E2E; --light: #FDFFFC; --accent: #FFC53D; --gray: #8B8BA0; }
        body { background: linear-gradient(135deg, var(--dark), #2D3047); color: var(--light); min-height: 100vh; padding: 0; line-height: 1.6; }
        body.modal-open { overflow: hidden; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .logo-container { display: flex; align-items: center; gap: 15px; text-decoration: none; }
        .logo-container img { height: 40px; }
        .logo-container .brand-name { font-size: 1.5rem; font-weight: bold; color: var(--light); }
        .hero-section { text-align: center; padding: 40px 0; }
        h1 { font-size: 3.5rem; margin-bottom: 10px; background: linear-gradient(to right, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 15px rgba(255, 197, 61, 0.2); }
        .tagline { color: var(--gray); font-size: 1.1rem; margin-bottom: 30px; }
        .special-features-container { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        .special-feature-link { padding: 12px 25px; border: 1px solid var(--accent); border-radius: 50px; display: inline-block; background: rgba(255, 197, 61, 0.1); transition: all 0.3s ease; }
        .special-feature-link a { color: var(--accent); text-decoration: none; font-weight: bold; }
        .special-feature-link:hover { background: rgba(255, 197, 61, 0.2); transform: scale(1.05); }
        .search-container { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); padding: 30px; border-radius: 20px; margin: 40px auto 30px; max-width: 800px; border: 1px solid rgba(255, 255, 255, 0.1); display: flex; flex-direction: column; gap: 20px; }
        .search-controls { display: flex; gap: 15px; flex-wrap: wrap; }
        #search-input { flex-grow: 1; padding: 18px 25px; border: none; border-radius: 50px; font-size: 1rem; background: rgba(30, 30, 46, 0.7); color: var(--light); }
        #search-input:focus { outline: none; box-shadow: 0 0 0 2px var(--secondary); }
        #search-btn { padding: 0 30px; border: none; border-radius: 50px; background: linear-gradient(to right, #FF5E5B, #d94645); color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s ease; }
        #search-btn:hover { transform: scale(1.05); }
        .search-wrapper { position: relative; flex-grow: 1; }
        #type-filter { padding: 0 25px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 50px; font-size: 1rem; background: rgba(30, 30, 46, 0.7); color: var(--light); cursor: pointer; }
        #type-filter:focus { outline: none; box-shadow: 0 0 0 2px var(--secondary); }
        .recommendation-bubbles { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; margin: 20px 0 40px; }
        .bubble { padding: 12px 25px; border-radius: 30px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); cursor: pointer; transition: all 0.2s ease-in-out; }
        .bubble:hover { transform: translateY(-3px); background: rgba(255, 255, 255, 0.1); }
        .bubble.active { background: rgba(255, 197, 61, 0.2); color: var(--accent); border-color: var(--accent); font-weight: bold; }
        .section-title { font-size: 2rem; margin-bottom: 25px; }
        .recommendation-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 25px; }
        .card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border-radius: 15px; overflow: hidden; transition: transform 0.3s ease, box-shadow 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); cursor: pointer; border: none; padding: 0;}
        .card:hover { transform: translateY(-8px); box-shadow: 0 10px 25px rgba(0,0,0,0.4); }
        .card-header { position: relative; }
        .card-header::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 50%; background: linear-gradient(to top, rgba(30, 30, 46, 0.9), transparent); }
        .poster { width: 100%; height: 380px; object-fit: cover; display: block; }
        .info { padding: 20px; position: relative; text-align: left;}
        .title { font-size: 1.3rem; margin-bottom: 8px; }
        .year { color: var(--accent); font-size: 0.9rem; }
        .details { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; }
        .rating { background: rgba(0, 206, 203, 0.2); padding: 5px 12px; border-radius: 20px; color: var(--secondary); display: flex; align-items: center; gap: 5px; }
        .type-badge { position: absolute; top: 15px; right: 15px; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; z-index: 2; }
        .movie-type { background: var(--primary); }
        .tv-type { background: var(--secondary); }
        .ad-space { background: rgba(0, 0, 0, 0.2); border: 1px dashed var(--gray); display: flex; align-items: center; justify-content: center; color: var(--gray); margin: 20px auto; border-radius: 10px; overflow: hidden;}
        .ad-leaderboard { width: 728px; height: 90px; max-width: 100%; }
        .load-more { margin: 30px auto; padding: 12px 30px; background: rgba(255, 255, 255, 0.1); color: var(--light); border-radius: 25px; cursor: pointer; display: none; }
        footer { text-align: center; margin-top: 60px; padding: 30px 0; border-top: 1px solid rgba(255, 255, 255, 0.1); }
        footer a { color: var(--gray); text-decoration: none; margin: 0 10px; }
        footer a:hover { color: var(--secondary); }
        .no-results { text-align: center; margin: 40px 0; display: none; }
        .static-content-section { text-align: center; max-width: 800px; margin: 60px auto; padding: 0 20px; }
        .faq-container { display: flex; flex-direction: column; gap: 15px; text-align: left; }
        .faq-item { background: rgba(255, 255, 255, 0.05); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .faq-question { padding: 20px; font-weight: bold; cursor: pointer; position: relative; }
        .faq-question:hover { color: var(--accent); }
        .faq-question::after { content: '+'; position: absolute; right: 20px; font-size: 1.5rem; transition: transform 0.2s ease; }
        .faq-item[open] .faq-question::after { transform: rotate(45deg); }
        .faq-answer { padding: 0 20px 20px; color: var(--gray); }

        /* Menu Styles */
        .main-nav { position: relative; }
        .menu-btn { background: none; border: none; color: var(--light); font-size: 1.5rem; cursor: pointer; z-index: 1001; }
        .nav-menu { display: none; position: absolute; right: 0; top: calc(100% + 10px); background-color: #2D3047; min-width: 220px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 100; border-radius: 10px; overflow: hidden; animation: slideDown 0.3s ease-out; }
        .nav-menu a { color: var(--light); padding: 15px 20px; text-decoration: none; display: flex; align-items: center; gap: 10px; }
        .nav-menu a i { width: 20px; text-align: center; }
        .nav-menu a:hover { background-color: var(--primary); }
        .main-nav.show .nav-menu { display: block; }
        .close-btn { display: none; }
        
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* Modal Styles */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 2000; display: none; align-items: center; justify-content: center; animation: fadeInModal 0.3s ease-out; }
        .modal-overlay.show { display: flex; }
        .modal { background: var(--dark); border: 1px solid rgba(255,255,255,0.1); width: 90%; max-width: 800px; max-height: 90vh; border-radius: 15px; overflow-y: auto; animation: slideDownModal 0.4s ease-out; }
        .modal-close { font-size: 2.5rem; color: var(--gray); position: absolute; top: 15px; right: 25px; cursor: pointer; }
        .modal-header { position: relative; padding-top: 56.25%; background-color: #000; }
        .modal-trailer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
        .modal-body { padding: 30px; }
        .modal-title { font-size: 2.5rem; margin-bottom: 10px; }
        .modal-genres { display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0; }
        .genre-tag { background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; }
        .modal-overview { color: var(--gray); line-height: 1.8; }
        .tmdb-link { color: var(--secondary); display: inline-block; margin-top: 20px; font-weight: bold; }
        #modal-loader { display: flex; justify-content: center; align-items: center; min-height: 400px; color: var(--accent); font-size: 1.5rem;}
        #modal-content { display: none; }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideDownModal { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 768px) {
            h1 { font-size: 2.8rem; }
            .search-controls { flex-direction: column; }
            #search-btn, #type-filter { width: 100%; justify-content: center; padding-top: 18px; padding-bottom: 18px; }
            .nav-menu { display: flex; flex-direction: column; position: fixed; top: 0; right: 0; width: 80%; max-width: 300px; height: 100vh; z-index: 1000; transform: translateX(100%); transition: transform 0.3s ease-in-out; box-shadow: -5px 0 15px rgba(0,0,0,0.3); }
            .main-nav.show .nav-menu { transform: translateX(0); }
            .nav-menu a { font-size: 1.2rem; padding: 20px; border-bottom: 1px solid var(--gray); }
            .close-btn { display: block; color: var(--light); font-size: 2rem; position: absolute; top: 15px; right: 20px; background: none; border: none; cursor: pointer; }
            .modal-title { font-size: 1.8rem; }
        }

        @media (max-width: 600px) {
            h1 { font-size: 2.2rem; }
            .section-title { font-size: 1.5rem; }
            .search-container { padding: 20px; }
            .bubble { padding: 10px 18px; font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="logo-container">
                <img src="logo.png" alt="PickMyBinge Logo">
                <span class="brand-name">PickMyBinge</span>
            </a>
            <nav class="main-nav">
                <button class="menu-btn"><i class="fas fa-bars"></i></button>
                <div class="nav-menu">
                    <button class="close-btn">&times;</button>
                    <a href="index.html"><i class="fas fa-home"></i> Home</a>
                    <a href="cringe.html"><i class="fas fa-ghost"></i> Cringe Finder</a>
                    <a href="quiz.html"><i class="fas fa-question-circle"></i> Character Quiz</a>
                </div>
            </nav>
        </header>

        <div class="hero-section">
            <h1>Find Your Next Obsession</h1>
            <p class="tagline">The ultimate tool for movie and TV show discovery.</p>
             <div class="special-features-container">
                <div class="special-feature-link">
                    <a href="cringe.html">üòà Dare to watch the worst? Enter the Cringe Zone.</a>
                </div>
                <div class="special-feature-link">
                    <a href="quiz.html">ü¶∏‚Äç‚ôÇÔ∏è Which hero (or villain) are you? Take the Quiz!</a>
                </div>
            </div>
        </div>

        <main>
            <section class="search-section" aria-labelledby="search-heading">
                <div class="search-container">
                    <div class="search-controls">
                        <div class="search-wrapper" style="flex-grow: 1;">
                            <input type="text" id="search-input" placeholder="Search for a specific title..." aria-label="Search for shows and movies">
                        </div>
                        <select id="type-filter" aria-label="Filter by type">
                            <option value="all">All Types</option>
                            <option value="movie">Movies Only</option>
                            <option value="tv">TV Shows Only</option>
                        </select>
                        <button id="search-btn">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                </div>
            
                <div class="recommendation-bubbles">
                    <div class="bubble active" data-search="popular" role="button">üî• Popular Now</div>
                    <div class="bubble" data-search="comedy" role="button">üòÇ Comedy</div>
                    <div class="bubble" data-search="action" role="button">üí• Action</div>
                    <div class="bubble" data-search="drama" role="button">üé≠ Drama</div>
                    <div class="bubble" data-search="korean" role="button">üá∞üá∑ Korean</div>
                    <div class="bubble" data-search="animation" role="button">üé® Animation</div>
                    <div class="bubble" data-search="horror" role="button">üò± Horror</div>
                    <div class="bubble" data-search="romance" role="button">üíï Romance</div>
                    <div class="bubble" data-search="sci-fi" role="button">üöÄ Sci-Fi</div>
                    <div class="bubble" data-search="thriller" role="button">üî™ Thriller</div>
                </div>
            </section>
        
            <div class="ad-space ad-leaderboard" id="ad-space-1">
                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7381421031784616" data-ad-slot="YOUR_AD_SLOT_ID_HERE" data-ad-format="auto" data-full-width-responsive="true"></ins>
                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>
        
            <section class="results-section" id="results-section" aria-labelledby="results-title">
                <h2 class="section-title" id="results-title">Recommended For You</h2>
                <div class="recommendation-cards" id="results" role="list" aria-live="polite"></div>
                <button class="load-more" id="load-more">Load More</button>
            </section>
        
            <div class="no-results" id="no-results"><h3>No results found</h3><p>Try a different search term or filter combination.</p></div>

            <section class="static-content-section">
                <h2 class="section-title">Discover Recommendations for Every Mood</h2>
                <p>Whether you're looking for a laugh-out-loud comedy, a high-octane action blockbuster, or an addictive Korean drama, PickMyBinge has you covered. Our smart engine filters thousands of titles to bring you the best, top-rated content you can watch right now. Stop scrolling and start watching!</p>
            </section>
        
            <div class="ad-space ad-leaderboard" id="ad-space-4">
                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7381421031784616" data-ad-slot="YOUR_AD_SLOT_ID_HERE" data-ad-format="auto" data-full-width-responsive="true"></ins>
                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>
        </main>
        
        <section id="faq-section" class="static-content-section">
            <h2 class="section-title">Frequently Asked Questions</h2>
            <div class="faq-container">
                <details class="faq-item">
                    <summary class="faq-question">What is PickMyBinge?</summary>
                    <div class="faq-answer"><p>PickMyBinge is a smart recommendation tool designed to help you quickly discover binge-worthy movies and TV shows. We use filters for genre, popularity, and ratings to help you stop scrolling and start watching.</p></div>
                </details>
                <details class="faq-item">
                    <summary class="faq-question">Is PickMyBinge free to use?</summary>
                    <div class="faq-answer"><p>Yes, PickMyBinge is 100% free for everyone. The site is supported by on-page advertisements and affiliate links, which means we may earn a small commission if you sign up for a service we recommend, at no extra cost to you.</p></div>
                </details>
                <details class="faq-item">
                    <summary class="faq-question">How do you get your movie and TV show data?</summary>
                    <div class="faq-answer"><p>Our data, including titles, posters, ratings, and release dates, is generously provided by The Movie Database (TMDB). It is a massive, community-built database that ensures our recommendations are always up-to-date.</p></div>
                </details>
                <details class="faq-item">
                    <summary class="faq-question">How do the recommendations work?</summary>
                    <div class="faq-answer"><p>Our recommendation engine sorts content by popularity and high user ratings from millions of viewers. When you select a genre, it finds the most-loved titles in that category, helping you discover proven hits you're likely to enjoy.</p></div>
                </details>
                <details class="faq-item">
                    <summary class="faq-question">How often is the content updated?</summary>
                    <div class="faq-answer"><p>Our movie and TV show library is updated daily through a direct connection with The Movie Database (TMDB), a live, community-driven database. This ensures you always have access to the latest and most popular titles.</p></div>
                </details>
            </div>
        </section>

        <footer>
            <p>PickMyBinge &copy; 2025</p>
             <div style="margin-top: 20px; text-align: center;">
                <a href="https://www.themoviedb.org/" target="_blank" rel="noopener noreferrer">
                    <img src="https://www.themoviedb.org/assets/2/v4/logos/v2/blue_square_1-59e852f8194f928695ada4f72d5fe9787b282d8d85f76f363d6b4bf8d9f03dcb.svg" alt="The Movie Database API" width="100">
                </a>
                <p style="font-size: 0.8rem; color: var(--gray); margin-top: 5px;">
                    This product uses the TMDB API but is not endorsed or certified by TMDB.
                </p>
            </div>
            <nav style="margin-top: 20px;">
                <a href="privacy.html">Privacy Policy</a>
                <a href="terms.html">Terms & Conditions</a>
                <a href="contact.html">Contact Us</a>
            </nav>
        </footer>
    </div>
    
    <div class="modal-overlay" id="details-modal">
        <div class="modal">
            <span class="modal-close" id="modal-close-btn">&times;</span>
            <div id="modal-loader"><i class="fas fa-spinner fa-spin"></i> &nbsp; Loading...</div>
            <div id="modal-content">
                <div class="modal-header">
                    <iframe class="modal-trailer" id="modal-trailer" allowfullscreen></iframe>
                </div>
                <div class="modal-body">
                    <h2 class="modal-title" id="modal-title"></h2>
                    <div class="modal-genres" id="modal-genres"></div>
                    <p class="modal-overview" id="modal-overview"></p>
                    <a id="modal-tmdb-link" class="tmdb-link" href="#" target="_blank" rel="noopener noreferrer">View full details on TMDB</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchBtn = document.getElementById('search-btn');
            const searchInput = document.getElementById('search-input');
            const resultsContainer = document.getElementById('results');
            const bubbles = document.querySelectorAll('.bubble');
            const typeFilter = document.getElementById('type-filter');
            const noResultsElement = document.getElementById('no-results');
            const loadMoreBtn = document.getElementById('load-more');
            
            const TMDB_API_KEY = '5102784aed4d28b56413afea83c2fb50'; 

            const genreMappings = { 'comedy': {movie: '35', tv: '35'}, 'action': {movie: '28', tv: '10759'}, 'drama': {movie: '18', tv: '18'}, 'sci-fi': {movie: '878', tv: '10765'}, 'thriller': {movie: '53', tv: '80'}, 'animation': {movie: '16', tv: '16'}, 'horror': {movie: '27', tv: '99'}, 'romance': {movie: '10749', tv: '10749'} };
            const languageMappings = { 'korean': 'ko' };
            
            let allFetchedResults = [];
            let displayedResultsCount = 0;
            const RESULTS_PER_LOAD = 8;
            let currentPage = 1;
            let currentQuery = '';
            let isTextSearch = false;
            let totalApiPages = 1;
            const activeFilters = new Set();

            const modalOverlay = document.getElementById('details-modal');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const modalLoader = document.getElementById('modal-loader');
            const modalContent = document.getElementById('modal-content');
            
            async function searchEntertainment(query, isNewSearch = true) {
                if (isNewSearch) {
                    currentPage = 1;
                    allFetchedResults = [];
                    displayedResultsCount = 0;
                    resultsContainer.innerHTML = '';
                    noResultsElement.style.display = 'none';
                }
                currentQuery = query;
                isTextSearch = !!query;
                await fetchAndProcessPage(query, currentPage);
            }
            
            async function fetchAndProcessPage(query, page) {
                const filterValue = typeFilter.value;
                let movies = [];
                let tvShows = [];

                if (filterValue === 'all') {
                    [movies, tvShows] = await Promise.all([ fetchData('movie', query, page, isTextSearch), fetchData('tv', query, page, isTextSearch) ]);
                } else if (filterValue === 'movie') {
                    movies = await fetchData('movie', query, page, isTextSearch);
                } else if (filterValue === 'tv') {
                    tvShows = await fetchData('tv', query, page, isTextSearch);
                }

                const newResults = shuffleArray([...movies, ...tvShows]);
                allFetchedResults.push(...newResults);
                
                if (allFetchedResults.length === 0 && page === 1) {
                    noResultsElement.style.display = 'block';
                    loadMoreBtn.style.display = 'none';
                } else {
                    displayMoreResults();
                }
            }

            async function fetchData(type, query, page, isTextSearch) {
                const TMDB_API_URL = 'https://api.themoviedb.org/3';
                let url;
                const params = new URLSearchParams({ api_key: TMDB_API_KEY, page: page, 'vote_count.gte': '150', 'vote_average.gte': '6' });

                if (isTextSearch) {
                    url = `${TMDB_API_URL}/search/${type}`;
                    params.append('query', query);
                } else {
                    url = `${TMDB_API_URL}/discover/${type}`;
                    params.append('sort_by', 'popularity.desc');
                    
                    const genreIds = [];
                    const languageCodes = [];

                    activeFilters.forEach(filter => {
                        if (genreMappings[filter]?.[type]) genreIds.push(genreMappings[filter][type]);
                        if (languageMappings[filter]) languageCodes.push(languageMappings[filter]);
                    });

                    if (genreIds.length > 0) params.append('with_genres', genreIds.join(','));
                    if (languageCodes.length > 0) params.append('with_original_language', languageCodes.join('|'));
                }
                
                try {
                    const response = await fetch(`${url}?${params.toString()}`);
                    if (!response.ok) { console.error(`API Error: ${response.statusText}`); return []; }
                    const data = await response.json();
                    totalApiPages = data.total_pages;
                    return data.results.map(item => ({ id: item.id, type: type, title: type === 'movie' ? item.title : item.name, year: (type === 'movie' ? item.release_date : item.first_air_date || '').substring(0, 4), poster: item.poster_path ? `https://image.tmdb.org/t/p/w500${item.poster_path}` : 'https://via.placeholder.com/300x450/2D3047/8B8BA0?text=No+Image', rating: item.vote_average.toFixed(1) }));
                } catch (error) {
                    console.error('Failed to fetch data:', error);
                }
            }

            function displayMoreResults() {
                const resultsToShow = allFetchedResults.slice(displayedResultsCount, displayedResultsCount + RESULTS_PER_LOAD);
                resultsToShow.forEach((item) => {
                    const card = document.createElement('button');
                    card.className = 'card';
                    card.dataset.id = item.id;
                    card.dataset.type = item.type;
                    card.innerHTML = `
                        <div class="card-header">
                            <img src="${item.poster}" alt="Poster for ${item.title}" class="poster" loading="lazy">
                            <span class="type-badge ${item.type}-type">${item.type === 'movie' ? 'Movie' : 'TV Show'}</span>
                        </div>
                        <div class="info">
                            <h3 class="title">${item.title}</h3>
                            <p class="year">${item.year || 'N/A'}</p>
                            <div class="details">
                                <span class="rating"><i class="fas fa-star"></i> ${item.rating}</span>
                            </div>
                        </div>`;
                    resultsContainer.appendChild(card);
                });
                displayedResultsCount += resultsToShow.length;
                loadMoreBtn.style.display = (displayedResultsCount < allFetchedResults.length || currentPage < totalApiPages) ? 'block' : 'none';
            }
            
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; }
                return array;
            }

            function triggerTextSearch() {
                const query = searchInput.value.trim();
                if (query) {
                    bubbles.forEach(b => b.classList.remove('active'));
                    document.querySelector('.bubble[data-search="popular"]').classList.add('active');
                    activeFilters.clear();
                    searchEntertainment(query, true);
                }
            }
            searchBtn.addEventListener('click', triggerTextSearch);
            searchInput.addEventListener('keypress', e => { if (e.key === 'Enter') triggerTextSearch(); });

            loadMoreBtn.addEventListener('click', () => {
                if (displayedResultsCount < allFetchedResults.length) {
                    displayMoreResults();
                } else if (currentPage < totalApiPages) {
                    currentPage++;
                    const query = isTextSearch ? currentQuery : null;
                    fetchAndProcessPage(query, currentPage);
                }
            });
            
            typeFilter.addEventListener('change', () => {
                const query = isTextSearch ? currentQuery : null;
                searchEntertainment(query, true);
            });

            bubbles.forEach(bubble => {
                bubble.addEventListener('click', () => {
                    searchInput.value = '';
                    const filter = bubble.dataset.search;

                    if (filter === 'popular') {
                        activeFilters.clear();
                        bubbles.forEach(b => b.classList.remove('active'));
                        bubble.classList.add('active');
                    } else {
                        document.querySelector('.bubble[data-search="popular"]').classList.remove('active');
                        if (activeFilters.has(filter)) {
                            activeFilters.delete(filter);
                            bubble.classList.remove('active');
                        } else {
                            if (activeFilters.size >= 2) {
                                alert('You can select a maximum of 2 filters.');
                                return;
                            }
                            activeFilters.add(filter);
                            bubble.classList.add('active');
                        }
                        if (activeFilters.size === 0) {
                            document.querySelector('.bubble[data-search="popular"]').classList.add('active');
                        }
                    }
                    searchEntertainment(null, true);
                });
            });
            
            const menuBtn = document.querySelector('.menu-btn');
            const closeBtn = document.querySelector('.close-btn');
            const mainNav = document.querySelector('.main-nav');

            if(menuBtn) {
                menuBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    mainNav.classList.toggle('show');
                });
            }
            if(closeBtn) {
                closeBtn.addEventListener('click', () => {
                    mainNav.classList.remove('show');
                });
            }
            window.addEventListener('click', (e) => {
                if (mainNav && !mainNav.contains(e.target)) {
                    mainNav.classList.remove('show');
                }
            });

            async function openDetailsModal(id, type) {
                modalOverlay.classList.add('show');
                document.body.classList.add('modal-open');
                modalLoader.style.display = 'flex';
                modalContent.style.display = 'none';

                const detailsUrl = `https://api.themoviedb.org/3/${type}/${id}?api_key=${TMDB_API_KEY}&append_to_response=videos`;
                
                try {
                    const response = await fetch(detailsUrl);
                    const data = await response.json();

                    document.getElementById('modal-title').textContent = data.name || data.title;
                    document.getElementById('modal-overview').textContent = data.overview || "No summary available.";
                    
                    const genresContainer = document.getElementById('modal-genres');
                    genresContainer.innerHTML = '';
                    data.genres.slice(0, 4).forEach(genre => {
                        const genreTag = document.createElement('span');
                        genreTag.className = 'genre-tag';
                        genreTag.textContent = genre.name;
                        genresContainer.appendChild(genreTag);
                    });

                    const trailer = data.videos.results.find(video => video.site === 'YouTube' && video.type === 'Trailer');
                    const trailerFrame = document.getElementById('modal-trailer');
                    if (trailer) {
                        trailerFrame.src = `https://www.youtube.com/embed/${trailer.key}`;
                        trailerFrame.parentElement.style.display = 'block';
                    } else {
                        trailerFrame.parentElement.style.display = 'none';
                    }

                    document.getElementById('modal-tmdb-link').href = `https://www.themoviedb.org/${type}/${id}`;

                    modalLoader.style.display = 'none';
                    modalContent.style.display = 'block';

                } catch (error) {
                    console.error("Failed to fetch details:", error);
                    closeDetailsModal();
                }
            }

            function closeDetailsModal() {
                modalOverlay.classList.remove('show');
                document.body.classList.remove('modal-open');
                document.getElementById('modal-trailer').src = '';
            }

            resultsContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.card');
                if (card) {
                    const id = card.dataset.id;
                    const type = card.dataset.type;
                    openDetailsModal(id, type);
                }
            });

            modalCloseBtn.addEventListener('click', closeDetailsModal);
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) {
                    closeDetailsModal();
                }
            });

            searchEntertainment(null, true);
        });
    </script>
</body>
</html>
